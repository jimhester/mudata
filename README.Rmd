---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# mudata2

<!-- [![](http://cranlogs.r-pkg.org/badges/mudata2)](https://cran.r-project.org/package=mudata2) [![Travis-CI Build Status](https://travis-ci.org/paleolimbot/mudata.svg?branch=master)](https://travis-ci.org/paleolimbot/mudata) [![Coverage Status](https://img.shields.io/codecov/c/github/paleolimbot/mudata/master.svg)](https://codecov.io/github/paleolimbot/mudata?branch=master) -->

The **mudata2** package provides tools to read, write, and add metadata to multi-parameter spatiotemporal data. The term "multi-parameter spatiotemporal data" is a mouthful, but all it means is that you measured a bunch of things (parameters) in a bunch of places (locations) at a bunch of different times. The best example of this is historical climate data, because it is usually set up in such a way that there are climate stations (locations) that measure some things (parameters, like temperature, precipitation, wind, etc.) at various points in time. This package is designed primarily for climate data and core data, however the format can be applied to many other types of data where parameters are measured along one or more common axes (time, depth, etc.).

## Installation

You can install mudata2 from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("paleolimbot/mudata")
```

## Using mudata objects

The basic idea of a mudata object is to store data with embedded documentation. For example, the `ns_climate` dataset is a collection of monthly climate observations from [Nova Scotia](https://www.wikipedia.org/wiki/Nova_Scotia) (Canada), from [Environment Canada](http://climate.weather.gc.ca/). You can have a quick glance at the object using `print()`, `summary()` or `autoplot()`.

```{r summary, message = FALSE, warning = FALSE}
library(mudata2)
print(ns_climate)
summary(ns_climate)
autoplot(ns_climate)
```

You can extract the data from the object using `tbl_data()` or `tbl_data_wide()`:

```{r}
ns_climate %>% tbl_data()
ns_climate %>% tbl_data_wide()
```

You can have a look at the embedded documentation using `tbl_params()`, `tbl_locations()`, `tbl_datasets()`, and `tbl_columns()`:

```{r}
ns_climate %>% tbl_params()
ns_climate %>% tbl_locations()
ns_climate %>% tbl_datasets()
ns_climate %>% tbl_columns()
```

You can subset mudata objects using `select_params()`, `select_locations()`, and `select_datasets()`, which use **dplyr**-like selection syntax to quickly subset mudata objects.

```{r}
ns_climate %>% 
  select_params(contains("temp"))
ns_climate %>% 
  select_locations(Kentville = starts_with("KENTVILLE"),
                   Sable = starts_with("SABLE"))
```

Finally, you can `filter()` individual tables using **dplyr**-like syntax (these functions also make sure all tables stay synced with each other):

```{r}
library(lubridate)
ns_climate %>%
  filter_data(month(date) == 6)
ns_climate %>%
  filter_locations(last_year > 2000)
```

## Creating mudata objects

Objects are created using the `mudata()` function, which takes a data frame/tibble with columns (at least) `param` and `value`. If you have more than one location, you will need a `location` column, and if you have points measured at more than one time, you'll need a column that describes the point in time (probably called `date` or `datetime`, or if you're a [paleolimnologist](https://www.wikipedia.org/wiki/Paleolimnology) like me, `depth` and/or `age`).

As an example, we'll use a small subset of data from two cores I collected a long time ago:

```{r, include = FALSE}
pocmajsum <- tibble::as_tibble(pocmajsum)
```

```{r, message=FALSE}
library(tidyverse)
poc_maj <- pocmajsum %>%
  select(core, depth, Ca, Ti, V)
poc_maj
```

Here, `depth` is the depth in the core, and `Ca`, `Ti`, and `V` are elemental concentrations in the sediment. To get this into parameter-long format, we need to use the `gather()` function in the **tidyr** package, and rename the `core` column to `location`.

```{r}
poc_maj_long <- poc_maj %>%
  gather(Ca, Ti, V, key = "param", value = "value") %>%
  rename(location = core)
poc_maj_long
```

This is the form of data needed by the `mudata()` constructor.

```{r poc-maj}
poc_maj_md <- mudata(poc_maj_long)
autoplot(poc_maj_md, y = "depth") + scale_y_reverse()
```

## More information

For more examples of `mudata` objects, see `alta_lake`, `long_lake`, and `kentvillegreenwood`. For more examples of mudata usage, see the package vignettes (coming soon...).
